

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>dom.js - Alpinejs-app Documentation</title>
    
    <meta name="description" content="A Simplest Single Page Application (SPA) library for Alpine.js." />
    
    
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>

    
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-start.html">Getting Started</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-start.html#installation">Installation</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#first-app">First app</a></li></ul></li><li><a href="tutorial-components.html">Components</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-components.html#component-lifecycle-and-event-handling">Component Lifecycle and Event Handling</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#event-emitter">Event emitter</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#custom-elements">Custom Elements</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#examples">Examples</a></li></ul></li><li><a href="tutorial-directives.html">Directives</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-template">Directive: **x-template**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-render">Directive: **x-render**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-scope-level">Directive: **x-scope-level**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-droppable">Directive: **x-droppable**</a></li></ul></li><li><a href="tutorial-magics.html">Magics</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-app">Magic: **$app**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-component">Magic: **$component**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-parent">Magic: **$parent**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-params">Magic: **$params**</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="AlpineComponent.html">AlpineComponent</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AlpineComponent.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="AlpineComponent.html#init">init</a></li></ul></li><li><a href="Component.html">Component</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Component.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="Component.html#init">init</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#$all">$all</a></li><li><a href="global.html#$append">$append</a></li><li><a href="global.html#$attr">$attr</a></li><li><a href="global.html#$data">$data</a></li><li><a href="global.html#$elem">$elem</a></li><li><a href="global.html#$empty">$empty</a></li><li><a href="global.html#$event">$event</a></li><li><a href="global.html#$off">$off</a></li><li><a href="global.html#$on">$on</a></li><li><a href="global.html#$param">$param</a></li><li><a href="global.html#$parse">$parse</a></li><li><a href="global.html#$ready">$ready</a></li><li><a href="global.html#__">__</a></li><li><a href="global.html#afetch">afetch</a></li><li><a href="global.html#call">call</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#escape">escape</a></li><li><a href="global.html#fetch">fetch</a></li><li><a href="global.html#fetchOptions">fetchOptions</a></li><li><a href="global.html#forEach">forEach</a></li><li><a href="global.html#forEachSeries">forEachSeries</a></li><li><a href="global.html#hideAlert">hideAlert</a></li><li><a href="global.html#hideToast">hideToast</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isElement">isElement</a></li><li><a href="global.html#isFlag">isFlag</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#loadResources">loadResources</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#noop">noop</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#only">only</a></li><li><a href="global.html#parallel">parallel</a></li><li><a href="global.html#parsePath">parsePath</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#resolve">resolve</a></li><li><a href="global.html#restorePath">restorePath</a></li><li><a href="global.html#sanitizer">sanitizer</a></li><li><a href="global.html#savePath">savePath</a></li><li><a href="global.html#sendFile">sendFile</a></li><li><a href="global.html#series">series</a></li><li><a href="global.html#showAlert">showAlert</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#split">split</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stylePlugin">stylePlugin</a></li><li><a href="global.html#toCamel">toCamel</a></li><li><a href="global.html#toDate">toDate</a></li><li><a href="global.html#toDuration">toDuration</a></li><li><a href="global.html#toNumber">toNumber</a></li><li><a href="global.html#toPrice">toPrice</a></li><li><a href="global.html#toSize">toSize</a></li><li><a href="global.html#toTitle">toTitle</a></li><li><a href="global.html#trace">trace</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">dom.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { app, call, isElement, isFunction, isObject, isString, toCamel } from "./app"
import { emit } from "./events"

/**
 * Returns a query parameter value from the current document location
 * @param {string} name
 * @param {string} [dflt]
 * @return {string}
 */
export function $param(name, dflt)
{
    return new URLSearchParams(location.search).get(name) || dflt || "";
}

const esc = (selector) => (selector.replace(/#([^\s"#']+)/g, (_, id) => `#${CSS.escape(id)}`))

/**
 * An alias to **document.querySelector**, doc can be an Element, empty or non-string selectors will return null
 * @param {string} selector
 * @param {HTMLElement} [doc]
 * @returns {null|HTMLElement}
 * @example
 * var el = app.$("#div")
 */
export function $(selector, doc)
{
    return isString(selector) ? (isElement(doc) || document).querySelector(esc(selector)) : null
}

/**
 * An alias for **document.querySelectorAll**
 * @param {string} selector
 * @param {HTMLElement} [doc]
 * @returns {null|HTMLElement[]}
 * @example
 * Array.from(app.$all("input")).find((el) => !(el.readOnly || el.disabled || el.type == "hidden"));
 */
export function $all(selector, doc)
{
    return isString(selector) ? (isElement(doc) || document).querySelectorAll(esc(selector)) : null
}

/**
 * Send a CustomEvent using DispatchEvent to the given element, true is set to composed, cancelable and bubbles properties.
 * @param {HTMLElement} element
 * @param {string} name
 * @param {object} [detail]
 */
export function $event(element, name, detail = {})
{
    return element instanceof EventTarget &amp;&amp; element.dispatchEvent(new CustomEvent(name, { detail, bubbles: true, composed: true, cancelable: true }))
}

/**
 * An alias for **element.addEventListener**
 * @param {HTMLElement} element
 * @param {string} event
 * @param {function} callback
 * @param {any} [...args] - additional params to addEventListener
 * @example
 * app.$on(window, "popstate", () => { ... })
 */
export function $on(element, event, callback, ...arg)
{
    return isFunction(callback) &amp;&amp; element.addEventListener(event, callback, ...arg)
}

/**
 * An alias for **element.removeEventListener**
 * @param {HTMLElement} element
 * @param {string} event
 * @param {function} callback
 * @param {any} [...args] - additional params to removeEventListener
 */
export function $off(element, event, callback, ...arg)
{
    return isFunction(callback) &amp;&amp; element.removeEventListener(event, callback, ...arg)
}

/**
 * Return or set attribute by name from the given element.
 * @param {HTMLElement|string} element
 * @param {string} attr
 * @param {any} [value]
 * - undefined - return the attribute value
 * - null - remove attribute
 * - any - assign new value
 * @returns {undefined|any}
 */
export function $attr(element, attr, value)
{
    if (isString(element)) element = $(element);
    if (!isElement(element)) return;
    return value === undefined ? element.getAttribute(attr) :
           value === null ? element.removeAttribute(attr) :
           element.setAttribute(attr, value);
}

/**
 * Remove all nodes from the given element, call the cleanup callback for each node if given
 * @param {HTMLElement|string} element
 * @param {functions} [cleanup]
 * @returns {HTMLElement}
 */
export function $empty(element, cleanup)
{
    if (isString(element)) element = $(element);
    if (!isElement(element)) return;
    while (element.firstChild) {
        const node = element.firstChild;
        node.remove();
        call(cleanup, node);
    }
    return element;
}

/**
 * Create a DOM element with attributes, **-name** means **style.name**, **.name** means a property **name**,
 * all other are attributes, functions are event listeners
 * @param {string} name
 * @param {any|object} [...args]
 * @param {object} [options]
 * @example
 * $elem("div", "id", "123", "-display", "none", "._x-prop", "value", "click", () => {})
 *
 * @example &lt;caption>Similar to above but all properties and attributes are taken from an object, in this form options can be passed, at the moment only
 * options for addEventListener are supported.&lt;/caption>
 *
 * $elem("div", { id: "123", "-display": "none", "._x-prop": "value", click: () => {} }, { signal })
 */
export function $elem(name, ...args)
{
    var element = document.createElement(name), key, val, opts;
    if (isObject(args[0])) {
        args = Object.entries(args[0]).flatMap(x => x);
        opts = args[1];
    }
    for (let i = 0; i &lt; args.length - 1; i += 2) {
        key = args[i], val = args[i + 1];
        if (!isString(key)) continue;
        if (isFunction(val)) {
            $on(element, key, val, { capture: opts?.capture, passive: opts?.passive, once: opts?.once, signal: opts?.signal });
        } else
        if (key.startsWith("-")) {
            element.style[key.substr(1)] = val;
        } else
        if (key.startsWith(".")) {
            element[key.substr(1)] = val;
        } else
        if (key.startsWith("data-")) {
            element.dataset[toCamel(key.substr(5))] = val;
        } else
        if (key == "text") {
            element.textContent = val || "";
        } else
        if (val !== null) {
            element.setAttribute(key, val ?? "");
        }
    }
    return element;
}

/**
 * A shortcut to DOMParser, default is to return the .body.
 * @param {string} html
 * @param {string} [format] - defines the result format:
 *  - list - the result will be an array with all body child nodes, i.e. simpler to feed it to Element.append()
 *  - doc - return the whole parsed document
 * @example
 * document.append(...$parse("&lt;div>...&lt;/div>"), 'list'))
 */
export function $parse(html, format)
{
    html = new window.DOMParser().parseFromString(html || "", 'text/html');
    return format === "doc" ? html : format === "list" ? Array.from(html.body.childNodes) : html.body;
}

/**
 * Append nodes from the template to the given element, call optional setup callback for each node.
 * @param {string|HTMLElement} element
 * @param {string|HTMLElement} template can be a string with HTML or a template element.
 * @param {function} [setup]
 * @example
 * app.$append(document, "&lt;div>...&lt;/div>")
 */
export function $append(element, template, setup)
{
    if (isString(element)) element = $(element);
    if (!isElement(element)) return;

    let doc;
    if (isString(template)) {
        doc = $parse(template, "doc");
    } else
    if (template?.content?.nodeType == 11) {
        doc = { body: template.content.cloneNode(true) };
    } else {
        return element;
    }

    let node;
    while (node = doc.head?.firstChild) {
        element.appendChild(node);
    }
    while (node = doc.body.firstChild) {
        element.appendChild(node);
        if (setup &amp;&amp; node.nodeType == 1) call(setup, node);
    }
    return element;
}

var _ready = []

/**
 * Run callback once the document is loaded and ready, it uses setTimeout to schedule callbacks
 * @param {function} callback
 * @example
 * app.$ready(() => {
 *
 * })
 */
export function $ready(callback)
{
    _ready.push(callback);
    if (document.readyState == "loading") return;
    while (_ready.length) setTimeout(call, 0, _ready.shift());
}

$on(window, "DOMContentLoaded", () => {
    while (_ready.length) setTimeout(call, 0, _ready.shift());
});

function domChanged()
{
    var w = document.documentElement.clientWidth;
    emit("dom:changed", {
        breakPoint: w &lt; 576 ? 'xs' : w &lt; 768 ? 'sm' : w &lt; 992 ? 'md' : w &lt; 1200 ? 'lg' : w &lt; 1400 ? 'xl' : 'xxl',
        colorScheme: window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light",
    });
}

$ready(() => {
    domChanged();
    $on(window.matchMedia('(prefers-color-scheme: dark)'), 'change', domChanged);

    var _resize;
    $on(window, "resize", () => {
        clearTimeout(_resize);
        _resize = setTimeout(domChanged, 250);
    });
});
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/vseryakov/docdash">docdash</a> theme.
</footer>


<script src="scripts/search.js" defer></script>



<script src="scripts/collapse.js" defer></script>



</body>
</html>
