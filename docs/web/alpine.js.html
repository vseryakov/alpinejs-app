

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>alpine.js - Alpinejs-app Documentation</title>
    
    <meta name="description" content="A Simplest Single Page Application (SPA) library for Alpine.js." />
    
    
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>

    
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-start.html">Getting Started</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-start.html#installation">Installation</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#first-app">First app</a></li></ul></li><li><a href="tutorial-components.html">Components</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-components.html#component-lifecycle-and-event-handling">Component Lifecycle and Event Handling</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#event-emitter">Event emitter</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#custom-elements">Custom Elements</a></li><li data-type='method' style='display: none;'><a href="tutorial-components.html#examples">Examples</a></li></ul></li><li><a href="tutorial-directives.html">Directives</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-template">Directive: **x-template**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-render">Directive: **x-render**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-scope-level">Directive: **x-scope-level**</a></li><li data-type='method' style='display: none;'><a href="tutorial-directives.html#directive-x-droppable">Directive: **x-droppable**</a></li></ul></li><li><a href="tutorial-magics.html">Magics</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-app">Magic: **$app**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-component">Magic: **$component**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-parent">Magic: **$parent**</a></li><li data-type='method' style='display: none;'><a href="tutorial-magics.html#magic-params">Magic: **$params**</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="AlpineComponent.html">AlpineComponent</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AlpineComponent.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="AlpineComponent.html#init">init</a></li></ul></li><li><a href="Component.html">Component</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Component.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="Component.html#init">init</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#$all">$all</a></li><li><a href="global.html#$append">$append</a></li><li><a href="global.html#$attr">$attr</a></li><li><a href="global.html#$data">$data</a></li><li><a href="global.html#$elem">$elem</a></li><li><a href="global.html#$empty">$empty</a></li><li><a href="global.html#$event">$event</a></li><li><a href="global.html#$off">$off</a></li><li><a href="global.html#$on">$on</a></li><li><a href="global.html#$param">$param</a></li><li><a href="global.html#$parse">$parse</a></li><li><a href="global.html#$ready">$ready</a></li><li><a href="global.html#__">__</a></li><li><a href="global.html#afetch">afetch</a></li><li><a href="global.html#call">call</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#escape">escape</a></li><li><a href="global.html#fetch">fetch</a></li><li><a href="global.html#fetchOptions">fetchOptions</a></li><li><a href="global.html#forEach">forEach</a></li><li><a href="global.html#forEachSeries">forEachSeries</a></li><li><a href="global.html#hideAlert">hideAlert</a></li><li><a href="global.html#hideToast">hideToast</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isElement">isElement</a></li><li><a href="global.html#isFlag">isFlag</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#loadResources">loadResources</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#noop">noop</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#once">once</a></li><li><a href="global.html#only">only</a></li><li><a href="global.html#parallel">parallel</a></li><li><a href="global.html#parsePath">parsePath</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#resolve">resolve</a></li><li><a href="global.html#restorePath">restorePath</a></li><li><a href="global.html#sanitizer">sanitizer</a></li><li><a href="global.html#savePath">savePath</a></li><li><a href="global.html#sendFile">sendFile</a></li><li><a href="global.html#series">series</a></li><li><a href="global.html#showAlert">showAlert</a></li><li><a href="global.html#showToast">showToast</a></li><li><a href="global.html#split">split</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stylePlugin">stylePlugin</a></li><li><a href="global.html#toCamel">toCamel</a></li><li><a href="global.html#toDate">toDate</a></li><li><a href="global.html#toDuration">toDuration</a></li><li><a href="global.html#toNumber">toNumber</a></li><li><a href="global.html#toPrice">toPrice</a></li><li><a href="global.html#toSize">toSize</a></li><li><a href="global.html#toTitle">toTitle</a></li><li><a href="global.html#trace">trace</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">alpine.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { app, isElement, isObject, isString } from './app';
import Component from './component';
import { fetch } from "./fetch";
import { $, $append, $elem, $empty, $off, $on } from "./dom";
import { emit } from "./events"
import { register, render, resolve } from "./render"
import { parsePath } from "./router"

const _alpine = "alpine";

var _Alpine;

/**
 * Alpine.js component
 * @param {string} name - component name
 * @param {object} [params] - properties passed during creation
 * @class
 * @extends Component
 * @example &lt;caption>Component code&lt;/caption>
 * app.components.items = class extends app.AlpineComponent {
 *   items = []
 *
 *   onCreate() {
 *       app.fetch("host/items", (err, items) => {
 *           this.items = items;
 *       })
 *   }
 *}
 * @example &lt;caption>Component template&lt;/caption>
 * &lt;div x-show="!list.length">
 *   Your basket is empty
 * &lt;/div>
 * &lt;template x-for="item in items">
 *   ID: &lt;div x-text="item.id">&lt;/div>
 * &lt;/template>
 */
class AlpineComponent extends Component {
    static $type = _alpine;

    constructor(name, params) {
        super(name, params);
        this.$type = _alpine;
    }

    init() {
        super.init(this.$root.parentElement._x_params);
    }

}

class Element extends HTMLElement {

    connectedCallback() {
        queueMicrotask(() => {
            _render(this, this.localName.substr(4));
        });
    }
}

function _render(element, options)
{
    if (isString(options)) {
        options = resolve(options);
        if (!options) return;
    }

    $empty(element);

    element._x_params = Object.assign({}, options.params);
    _Alpine.onElRemoved(element, () => { delete element._x_params });

    if (!options.component) {
        _Alpine.mutateDom(() => {
            $append(element, options.template, _Alpine.initTree);
        });
    } else {
        // In case a component was loaded after alpine:init event
        _Alpine.data(options.name, () => (new options.component(options.name)));

        const node = $elem("div", "x-data", options.name);
        $append(node, options.template);

        _Alpine.mutateDom(() => {
            element.appendChild(node);
            _Alpine.initTree(node);
        });
    }
    return options;
}

function data(element, level)
{
    if (!isElement(element)) element = $(app.$target + " div");
    if (!element) return;
    if (typeof level == "number") return element._x_dataStack?.at(level);
    return _Alpine.closestDataStack(element)[0];
}

function init()
{
    for (const [name, obj] of Object.entries(app.components)) {
        const tag = `app-${obj?.$tag || name}`;
        if (obj?.$type != _alpine || customElements.get(tag)) continue;
        customElements.define(tag, class extends Element {});
        _Alpine.data(name, () => (new obj(name)));
    }
}

function $render(el, value, modifiers, callback)
{
    const cache = modifiers.includes("cache");
    const opts = { post: modifiers.includes("post") };

    if (!value.url &amp;&amp; !(!cache &amp;&amp; /^(https?:\/\/|\/|.+\.html(\?|$)).+/.test(value))) {
        if (callback(el, value)) return;
    }
    fetch(value, opts, (err, text, info) => {
        if (err || !isString(text)) {
            return console.warn("$render: Text expected from", value, "got", err, text);
        }
        const tmpl = isString(value) ? parsePath(value) : value;
        tmpl.template = text;
        tmpl.name = tmpl.params?.$name || tmpl.name;
        if (cache) {
            app.templates[tmpl.name] = text;
        }
        callback(el, tmpl);
    });
}

function $template(el, value, modifiers)
{
    const mods = {};

    const toMods = (tmpl) => {
        for (let i = 0; i &lt; modifiers.length; i++) {
            const mod = modifiers[i];
            switch (mod) {
            case "params":
                var scope = _Alpine.$data(el);
                if (!isObject(scope[modifiers[i + 1]])) break;
                tmpl.params = Object.assign(scope[modifiers[i + 1]], tmpl.params);
                break;
            case "inline":
                mods.inline = "inline-block";
                break;
            default:
                mods[mod] = mod;
            }
        }
        return tmpl;
    }

    $render(el, value, modifiers, (el, tmpl) => {
        tmpl = resolve(tmpl);
        if (!tmpl) return;

        if (!_render(el, toMods(tmpl))) return;

        if (mods.show) {
            if (mods.nonempty &amp;&amp; !el.firstChild) {
                el.style.setProperty('display', "none", mods.important);
            } else {
                el.style.setProperty('display', mods.flex || mods.inline || "block", mods.important)
            }
        }
        return true;
    });

}

register(_alpine, { render: _render, Component: AlpineComponent, data, init, default: 1 });

export { AlpineComponent };

export default AlpineComponent;

export function AlpinePlugin(Alpine)
{
    _Alpine = Alpine;

    emit("alpine:init");

    Alpine.magic("app", (el) => app);

    Alpine.magic("params", (el) => {
        while (el) {
            if (el._x_params) return el._x_params;
            el = el.parentElement;
        }
    });

    Alpine.magic("component", (el) => (Alpine.closestDataStack(el).find(x => x.$type == _alpine &amp;&amp; x.$name)));

    Alpine.magic("parent", (el) => (Alpine.closestDataStack(el).filter(x => x.$type == _alpine &amp;&amp; x.$name)[1]));

    Alpine.directive("render", (el, { modifiers, expression }, { evaluate, cleanup }) => {
        const click = (e) => {
            const value = evaluate(expression);
            if (!value) return;
            e.preventDefault();
            if (modifiers.includes("stop")) {
                e.stopPropagation();
            }
            $render(el, value, modifiers, (el, tmpl) => (render(tmpl)));
        }
        $on(el, "click", click)
        el.style.cursor = "pointer";

        cleanup(() => {
            $off(el, 'click', click)
        })
    });

    Alpine.directive('template', (el, { modifiers, expression }, { effect, cleanup }) => {
        const evaluate = Alpine.evaluateLater(el, expression);
        var template;

        const empty = () => {
            template = null;
            Alpine.mutateDom(() => {
                $empty(el, (node) => Alpine.destroyTree(node));

                if (modifiers.includes("show")) {
                    el.style.setProperty('display', "none", modifiers.includes('important') ? 'important' : undefined);
                }
            })
        }

        effect(() => evaluate(value => {
            if (!value) return empty();

            if (value !== template) {
                $template(el, value, modifiers);
            }
            template = value;
        }))

        cleanup(empty);
    });

    Alpine.directive("scope-level", (el, { expression }, { evaluate }) => {
        const scope = Alpine.closestDataStack(el);
        el._x_dataStack = scope.slice(0, parseInt(evaluate(expression || "")) || 0);
    });

    Alpine.directive('droppable', (el, { expression }, { evaluate, cleanup }) => {
        const target = evaluate(expression)
        var current = null;

        app.$on(el, "click", click);
        app.$on(el, "drop", drop);
        app.$on(el, "dragdrop", drop);
        app.$on(el, "dragenter", dragenter);
        app.$on(el, "dragleave", dragleave);
        app.$on(el, "dragover", dragover);

        cleanup(() => {
            app.$off(el, "click", click);
            app.$off(el, "drop", drop);
            app.$off(el, "dragdrop", drop);
            app.$off(el, "dragenter", dragenter)
            app.$off(el, "dragleave", dragleave)
            app.$off(el, "dragover", dragover);
        })

        function click(event) {
            app.$('[type="file"]', el).click();
        }

        function drop(event) {
            event.preventDefault();
            var file = event.dataTransfer.files[0];
            app.emit(app.event, "file:dropped", { file, event });
            target.dragging = 0;
        }

        function dragenter(event) {
            current = event.target;
            target.dragging = 1;
        }

        function dragleave(event) {
            if (event.target === current) {
                target.dragging = 0;
            }
        }

        function dragover(event) {
            event.preventDefault();
            target.dragging = 1;
        }

    })


}

</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/vseryakov/docdash">docdash</a> theme.
</footer>


<script src="scripts/search.js" defer></script>



<script src="scripts/collapse.js" defer></script>



</body>
</html>
