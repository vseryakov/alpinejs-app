var n={base:"/app/",$target:"#app-main",index:"index",event:"component:event",templates:{},components:{},isF:l,isS:c,isE:h,isO:d,toCamel:g};function c(t){return typeof t=="string"&&t}function l(t){return typeof t=="function"&&t}function d(t){return typeof t=="object"&&t}function h(t){return t instanceof HTMLElement&&t}function g(t){return c(t)?t.toLowerCase().replace(/[.:_-](\w)/g,(e,r)=>r.toUpperCase()):""}n.noop=()=>{};n.log=(...t)=>console.log(...t);n.trace=(...t)=>{n.debug&&n.log(...t)};n.call=(t,e,...r)=>{if(l(t))return t(e,...r);if(typeof t=="object"){if(l(e))return e.call(t,...r);if(t&&l(t[e]))return t[e].call(t,...r)}};var u={};n.on=(t,e,r)=>{l(e)&&(u[t]||(u[t]=[]),u[t].push([e,c(r)]))};n.once=(t,e,r)=>{if(!l(e))return;let i=(...s)=>{n.off(t,i),e(...s)};n.on(t,i,r)};n.only=(t,e,r)=>{u[t]=l(e)?[e,c(r)]:[]};n.off=(t,e)=>{if(t&&e){if(!u[t])return;let r=l(e)?0:c(e)?1:-1;r>=0&&(u[t]=u[t].filter(i=>i[r]!==e))}else if(c(t))for(let r in u)u[r]=u[r].filter(i=>i[1]!==t)};n.emit=(t,...e)=>{if(n.trace("emit:",t,...e,n.debug>1&&u[t]),u[t])for(let r of u[t])r[0](...e);else if(c(t)&&t.endsWith(":*")){t=t.slice(0,-1);for(let r in u)if(r.startsWith(t))for(let i of u[r])i[0](...e)}};n.$param=(t,e)=>new URLSearchParams(location.search).get(t)||e||"";var _=t=>t.replace(/#([^\s"#']+)/g,(e,r)=>`#${CSS.escape(r)}`);n.$=(t,e)=>c(t)?(h(e)||document).querySelector(_(t)):null;n.$all=(t,e)=>c(t)?(h(e)||document).querySelectorAll(_(t)):null;n.$event=(t,e,r={})=>t instanceof EventTarget&&t.dispatchEvent(new CustomEvent(e,{detail:r,bubbles:!0,composed:!0,cancelable:!0}));n.$on=(t,e,r,...i)=>l(r)&&t.addEventListener(e,r,...i);n.$off=(t,e,r,...i)=>l(r)&&t.removeEventListener(e,r,...i);n.$attr=(t,e,r)=>{if(c(t)&&(t=n.$(t)),!!h(t))return r===void 0?t.getAttribute(e):r===null?t.removeAttribute(e):t.setAttribute(e,r)};n.$empty=(t,e)=>{if(c(t)&&(t=n.$(t)),!!h(t)){for(;t.firstChild;){let r=t.firstChild;r.remove(),n.call(e,r)}return t}};n.$elem=(t,...e)=>{var r=document.createElement(t),i,s,o;d(e[0])&&(e=Object.entries(e[0]).flatMap(a=>a),o=e[1]);for(let a=0;a<e.length-1;a+=2)i=e[a],s=e[a+1],c(i)&&(l(s)?n.$on(r,i,s,{capture:o?.capture,passive:o?.passive,once:o?.once,signal:o?.signal}):i.startsWith("-")?r.style[i.substr(1)]=s:i.startsWith(".")?r[i.substr(1)]=s:i.startsWith("data-")?r.dataset[g(i.substr(5))]=s:i=="text"?r.textContent=s||"":s!==null&&r.setAttribute(i,s??""));return r};n.$parse=(t,e)=>(t=new window.DOMParser().parseFromString(t||"","text/html"),e==="doc"?t:e==="list"?Array.from(t.body.childNodes):t.body);n.$append=(t,e,r)=>{if(c(t)&&(t=n.$(t)),!h(t))return;let i;if(c(e))i=n.$parse(e,"doc");else if(e?.content?.nodeType==11)i={body:e.content.cloneNode(!0)};else return t;let s;for(;s=i.head?.firstChild;)t.appendChild(s);for(;s=i.body.firstChild;)t.appendChild(s),r&&s.nodeType==1&&n.call(r,s);return t};var b=[];n.$ready=t=>{if(b.push(t),document.readyState!="loading")for(;b.length;)setTimeout(n.call,0,b.shift())};n.$on(window,"DOMContentLoaded",()=>{for(;b.length;)setTimeout(n.call,0,b.shift())});n.parsePath=t=>{var e={name:"",params:{}},r,i=window.location;if(d(t))return Object.assign(e,t);if(!c(t))return e;var s=n.base;t.startsWith(i.origin)&&(t=t.substr(i.origin.length)),t.includes("://")&&(t=t.replace(/^(.*:\/\/[^/]*)/,"")),t.startsWith(s)&&(t=t.substr(s.length)),t.startsWith("/")&&(t=t.substr(1)),t==s.slice(1,-1)&&(t="");let o=t.indexOf("?");if(o>0&&(r=t.substr(o+1,1024),e.name=t=t.substr(0,o)),t.endsWith(".html")&&(t=t.slice(0,-5)),t.includes("/")){t=t.split("/").slice(0,7),e.name=t.shift();for(let a=0;a<t.length;a++)t[a]&&(e.params[`param${a+1}`]=t[a])}else e.name=t||"";if(r)for(let[a,p]of new URLSearchParams(r).entries())e.params[a]=p;return e};n.savePath=t=>{if(c(t)&&(t={name:t}),!!t?.name){var e=[t.name];if(t?.params)for(let r=1;r<7;r++)e.push(t.params[`param${r}`]||"");for(;!e.at(-1);)e.length--;e=e.join("/"),n.trace("savePath:",e,t),e&&(n.emit("path:push",window.location.origin+n.base+e),window.history.pushState(null,"",window.location.origin+n.base+e))}};n.restorePath=t=>{n.trace("restorePath:",t,n.index),n.render(t,n.index)};n.start=()=>{n.on("path:save",n.savePath),n.on("path:restore",n.restorePath),n.$ready(n.restorePath.bind(n,window.location.href))};n.$on(window,"popstate",()=>n.emit("path:restore",window.location.href));var $={},S;n.plugin=(t,e)=>{if(!t||!c(t))throw Error("type must be defined");if(e){for(let i of["render","cleanup","data"])if(e[i]&&!l(e[i]))throw Error(i+" must be a function");l(e?.Component)&&(n[`${t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()}Component`]=e.Component)}var r=$[t]=$[t]||{};return e?.default&&(S=r),Object.assign(r,e)};n.$data=(t,e)=>{c(t)&&(t=n.$(t));for(let r in $){if(!$[r].data)continue;let i=$[r].data(t,e);if(i)return i}};n.resolve=(t,e)=>{let r=n.parsePath(t);n.trace("resolve:",t,e,r);var i=r?.name,s=n.templates,o=n.components,a=r.template||s[i]||document.getElementById(i);if(!a&&e&&(a=s[e]||document.getElementById(e),a&&(r.name=e)),c(a)&&a.startsWith("#")?a=document.getElementById(r.otemplate=a.substr(1)):c(a)&&a.startsWith("$")&&(a=s[r.otemplate=a.substr(1)]),!!a){r.template=a;var p=o[i]||o[r.name];return c(p)&&(p=o[r.ocomponent=p]),r.component=p,r}};n.render=(t,e)=>{var r=n.resolve(t,e);if(!r)return;var i=r.params=Object.assign(r.params||{},t?.params);i.$target=t.$target||i.$target||n.$target,n.trace("render:",t,r.name,r.params);let s=h(i.$target)||n.$(i.$target);if(s){var o=r.component?.$type||t?.plugin||i.$plugin;if(o=$[o]||S,!!o?.render){if(i.$target==n.$target){var a={name:r.name,params:i};if(n.emit(n.event,"prepare:delete",a),a.stop)return;var p=Object.values($);for(let f of p.filter(m=>m.cleanup))n.call(f.cleanup,s);t?.$nohistory||i.$nohistory||r.component?.$nohistory||n.$nohistory||queueMicrotask(()=>{n.emit("path:save",r)})}return n.emit("component:render",r),o.render(s,r),r}}};n.on("alpine:init",()=>{for(let t in $)n.call($[t],"init")});var v=class{params={};constructor(e,r){this.$name=e,Object.assign(this.params,r),this._handleEvent=P.bind(this),this._onCreate=this.onCreate||null,this._onDelete=this.onDelete||null}init(e){n.trace("init:",this.$type,this.$name),Object.assign(this.params,e),n.emit("component:create",{type:this.$type,name:this.$name,component:this,element:this.$el,params:this.params}),this.params.$noevents||n.on(n.event,this._handleEvent),n.call(this._onCreate?.bind(this,this.params))}destroy(){n.trace("destroy:",this.$type,this.$name),n.off(n.event,this._handleEvent),n.emit("component:delete",{type:this.$type,name:this.$name,component:this,element:this.$el,params:this.params}),n.call(this._onDelete?.bind(this)),this.params={},delete this.$root}};function P(t,...e){if(this.onEvent&&(n.trace("event:",this.$type,this.$name,t,...e),n.call(this.onEvent?.bind(this.$data||this),t,...e)),!!c(t)){var r=g("on_"+t);this[r]&&(n.trace("event:",this.$type,this.$name,r,...e),n.call(this[r]?.bind(this.$data||this),...e))}}var w=v;var y="alpine",E=class extends w{static $type=y;constructor(e,r){super(e,r),this.$type=y}init(){super.init(this.$root.parentElement._x_params)}},x=class extends HTMLElement{connectedCallback(){queueMicrotask(()=>{C(this,this.localName.substr(4))})}};function C(t,e){if(!(c(e)&&(e=n.resolve(e),!e))){if(n.$empty(t),t._x_params=Object.assign({},e.params),!e.component)Alpine.mutateDom(()=>{n.$append(t,e.template,Alpine.initTree)});else{Alpine.data(e.name,()=>new e.component(e.name));let r=n.$elem("div","x-data",e.name);n.$append(r,e.template),Alpine.mutateDom(()=>{t.appendChild(r),Alpine.initTree(r)})}return e}}function T(t,e){if(h(t)||(t=n.$(n.$target+" div")),!!t)return typeof e=="number"?t._x_dataStack?.at(e):Alpine.closestDataStack(t)[0]}function j(){for(let[t,e]of Object.entries(n.components)){let r=`app-${e?.$tag||t}`;e?.$type!=y||customElements.get(r)||(customElements.define(r,class extends x{}),Alpine.data(t,()=>new e(t)))}}function A(t,e,r,i){let s=r.includes("cache"),o=r.includes("post")?n.post:n.fetch;!e.url&&!(!s&&/^(https?:\/\/|\/|.+\.html(\?|$)).+/.test(e))&&i(t,e)||o(e,(a,p,f)=>{if(a||!c(p))return console.warn("$render: Text expected from",e,"got",a,p);let m=c(e)?n.parsePath(e):e;m.template=p,s?(m.name=m.params?.$name||m.name,n.templates[m.name]=p):m.name="",i(t,m)})}function D(t,e,r){let i={},s=o=>{for(let p=0;p<r.length;p++){let f=r[p];switch(f){case"params":var a=Alpine.$data(t);if(!d(a[r[p+1]]))break;o.params=Object.assign(a[r[p+1]],o.params);break;case"inline":i.inline="inline-block";break;default:i[f]=f}}return o};A(t,e,r,(o,a)=>{if(a=n.resolve(a),!!a&&C(o,s(a)))return i.show&&(i.nonempty&&!o.firstChild?o.style.setProperty("display","none",i.important):o.style.setProperty("display",i.flex||i.inline||"block",i.important)),!0})}n.plugin(y,{render:C,Component:E,data:T,init:j,default:1});n.$on(document,"alpine:init",()=>{n.emit("alpine:init"),Alpine.magic("app",t=>n),Alpine.magic("params",t=>{for(;t;){if(t._x_params)return t._x_params;t=t.parentElement}}),Alpine.magic("component",t=>Alpine.closestDataStack(t).find(e=>e.$type==y&&e.$name)),Alpine.magic("parent",t=>Alpine.closestDataStack(t).filter(e=>e.$type==y&&e.$name)[1]),Alpine.directive("render",(t,{modifiers:e,expression:r},{evaluate:i,cleanup:s})=>{let o=a=>{let p=i(r);p&&(a.preventDefault(),e.includes("stop")&&a.stopPropagation(),A(t,p,e,(f,m)=>n.render(m)))};n.$on(t,"click",o),t.style.cursor="pointer",s(()=>{n.$off(t,"click",o)})}),Alpine.directive("template",(t,{modifiers:e,expression:r},{effect:i,cleanup:s})=>{let o=Alpine.evaluateLater(t,r);var a;let p=()=>{a=null,Alpine.mutateDom(()=>{n.$empty(t,f=>Alpine.destroyTree(f)),e.includes("show")&&t.style.setProperty("display","none",e.includes("important")?"important":void 0)})};i(()=>o(f=>{if(!f)return p();f!==a&&D(t,f,e),a=f})),s(p)}),Alpine.directive("scope-level",(t,{expression:e},{evaluate:r})=>{let i=Alpine.closestDataStack(t);t._x_dataStack=i.slice(0,parseInt(r(e||""))||0)})});n.fetchOpts=function(t){var e=t.headers||{},r=Object.assign({headers:e,method:t.type||"GET",cache:"default"},t.fetchOptions),i=t.data;return r.method=="GET"||r.method=="HEAD"?d(i)&&(t.url+="?"+new URLSearchParams(i).toString()):c(i)?(r.body=i,e["content-type"]=t.contentType||"application/x-www-form-urlencoded; charset=UTF-8"):i instanceof FormData?(r.body=i,delete e["content-type"]):d(i)?(r.body=JSON.stringify(i),e["content-type"]="application/json; charset=UTF-8"):i&&(r.body=i,e["content-type"]=t.contentType||"application/octet-stream"),r};n.fetch=function(t,e){try{c(t)&&(t={url:t});let r=n.fetchOpts(t);n.trace("fetch:",r,t),window.fetch(t.url,r).then(async i=>{var s,o,a={status:i.status,headers:{},type:i.type,url:i.url,redirected:i.redirected};for(let p of i.headers)a.headers[p[0].toLowerCase()]=p[1];if(!i.ok){if(/\/json/.test(a.headers["content-type"])){let p=await i.json();s={status:i.status};for(let f in p)s[f]=p[f]}else s={message:await i.text(),status:i.status};return n.call(e,s,o,a)}switch(t.dataType){case"text":o=await i.text();break;case"blob":o=await i.blob();break;default:o=/\/json/.test(a.headers["content-type"])?await i.json():await i.text()}n.call(e,null,o,a)}).catch(i=>{n.call(e,i)})}catch(r){n.call(e,r)}};n.afetch=function(t){return new Promise((e,r)=>{n.fetch(t,(i,s,o)=>{if(i)return r(i,s,o);e(s,o)})})};n.post=function(t,e){c(t)&&(t={url:t}),d(t)&&(t.type="POST"),n.fetch(t,e)};n.Component=w;var O=n;var et=O;export{et as default};
