var n={base:"/app/",$target:"#app-main",index:"index",event:"component:event",templates:{},components:{},isF:f,isS:c,isE:d,isO:h,isN:P,toCamel:g};function P(t){return typeof t=="number"?t:void 0}function c(t){return typeof t=="string"&&t}function f(t){return typeof t=="function"&&t}function h(t){return typeof t=="object"&&t}function d(t){return t instanceof HTMLElement&&t}function g(t){return c(t)?t.toLowerCase().replace(/[.:_-](\w)/g,(e,r)=>r.toUpperCase()):""}n.noop=()=>{};n.log=(...t)=>console.log(...t);n.trace=(...t)=>{n.debug&&n.log(...t)};n.call=(t,e,...r)=>{if(f(t))return t(e,...r);if(typeof t=="object"){if(f(e))return e.call(t,...r);if(t&&f(t[e]))return t[e].call(t,...r)}};var u={};n.on=(t,e,r)=>{f(e)&&(u[t]||(u[t]=[]),u[t].push([e,c(r)]))};n.once=(t,e,r)=>{if(!f(e))return;let i=(...a)=>{n.off(t,i),e(...a)};n.on(t,i,r)};n.only=(t,e,r)=>{u[t]=f(e)?[e,c(r)]:[]};n.off=(t,e)=>{if(t&&e){if(!u[t])return;let r=f(e)?0:c(e)?1:-1;r>=0&&(u[t]=u[t].filter(i=>i[r]!==e))}else if(c(t))for(let r in u)u[r]=u[r].filter(i=>i[1]!==t)};n.emit=(t,...e)=>{if(n.trace("emit:",t,...e,n.debug>1&&u[t]),u[t])for(let r of u[t])r[0](...e);else if(c(t)&&t.endsWith(":*")){t=t.slice(0,-1);for(let r in u)if(r.startsWith(t))for(let i of u[r])i[0](...e)}};n.$param=(t,e)=>new URLSearchParams(location.search).get(t)||e||"";var C=t=>t.replace(/#([^\s"#']+)/g,(e,r)=>`#${CSS.escape(r)}`);n.$=(t,e)=>c(t)?(d(e)||document).querySelector(C(t)):null;n.$all=(t,e)=>c(t)?(d(e)||document).querySelectorAll(C(t)):null;n.$event=(t,e,r={})=>t instanceof EventTarget&&t.dispatchEvent(new CustomEvent(e,{detail:r,bubbles:!0,composed:!0,cancelable:!0}));n.$on=(t,e,r,...i)=>f(r)&&t.addEventListener(e,r,...i);n.$off=(t,e,r,...i)=>f(r)&&t.removeEventListener(e,r,...i);n.$attr=(t,e,r)=>{if(c(t)&&(t=n.$(t)),!!d(t))return r===void 0?t.getAttribute(e):r===null?t.removeAttribute(e):t.setAttribute(e,r)};n.$empty=(t,e)=>{if(c(t)&&(t=n.$(t)),!!d(t)){for(;t.firstChild;){let r=t.firstChild;r.remove(),n.call(e,r)}return t}};n.$elem=(t,...e)=>{var r=document.createElement(t),i,a,o;h(e[0])&&(e=Object.entries(e[0]).flatMap(s=>s),o=e[1]);for(let s=0;s<e.length-1;s+=2)i=e[s],a=e[s+1],c(i)&&(f(a)?n.$on(r,i,a,{capture:o?.capture,passive:o?.passive,once:o?.once,signal:o?.signal}):i.startsWith("-")?r.style[i.substr(1)]=a:i.startsWith(".")?r[i.substr(1)]=a:i.startsWith("data-")?r.dataset[g(i.substr(5))]=a:i=="text"?r.textContent=a||"":a!==null&&r.setAttribute(i,a??""));return r};n.$parse=(t,e)=>(t=new window.DOMParser().parseFromString(t||"","text/html"),e==="doc"?t:e==="list"?Array.from(t.body.childNodes):t.body);n.$append=(t,e,r)=>{if(c(t)&&(t=n.$(t)),!d(t))return;let i;if(c(e))i=n.$parse(e,"doc");else if(e?.content?.nodeType==11)i={body:e.content.cloneNode(!0)};else return t;let a;for(;a=i.head?.firstChild;)t.appendChild(a);for(;a=i.body.firstChild;)t.appendChild(a),r&&a.nodeType==1&&n.call(r,a);return t};var b=[];n.$ready=t=>{if(b.push(t),document.readyState!="loading")for(;b.length;)setTimeout(n.call,0,b.shift())};n.$on(window,"DOMContentLoaded",()=>{for(;b.length;)setTimeout(n.call,0,b.shift())});n.parsePath=t=>{var e={name:"",params:{}},r,i=window.location;if(h(t))return Object.assign(e,t);if(!c(t))return e;var a=n.base;t.startsWith(i.origin)&&(t=t.substr(i.origin.length)),t.includes("://")&&(t=t.replace(/^(.*:\/\/[^/]*)/,"")),t.startsWith(a)&&(t=t.substr(a.length)),t.startsWith("/")&&(t=t.substr(1)),t==a.slice(1,-1)&&(t="");let o=t.indexOf("?");if(o>0&&(r=t.substr(o+1,1024),e.name=t=t.substr(0,o)),t.endsWith(".html")&&(t=t.slice(0,-5)),t.includes("/")){t=t.split("/").slice(0,7),e.name=t.shift();for(let s=0;s<t.length;s++)t[s]&&(e.params[`param${s+1}`]=t[s])}else e.name=t||"";if(r)for(let[s,p]of new URLSearchParams(r).entries())e.params[s]=p;return e};n.savePath=t=>{if(c(t)&&(t={name:t}),!!t?.name){var e=[t.name];if(t?.params)for(let r=1;r<7;r++)e.push(t.params[`param${r}`]||"");for(;!e.at(-1);)e.length--;e=e.join("/"),n.trace("savePath:",e,t),e&&(n.emit("path:push",window.location.origin+n.base+e),window.history.pushState(null,"",window.location.origin+n.base+e))}};n.restorePath=t=>{n.trace("restorePath:",t,n.index),n.render(t,n.index)};n.start=()=>{n.on("path:save",n.savePath),n.on("path:restore",n.restorePath),n.$ready(n.restorePath.bind(n,window.location.href))};n.$on(window,"popstate",()=>n.emit("path:restore",window.location.href));var $={},A;n.plugin=(t,e)=>{if(!t||!c(t))throw Error("type must be defined");if(e){for(let i of["render","cleanup","data"])if(e[i]&&!f(e[i]))throw Error(i+" must be a function");f(e?.Component)&&(n[`${t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()}Component`]=e.Component)}var r=$[t]=$[t]||{};return e?.default&&(A=r),Object.assign(r,e)};n.$data=(t,e)=>{c(t)&&(t=n.$(t));for(let r in $){if(!$[r].data)continue;let i=$[r].data(t,e);if(i)return i}};n.resolve=(t,e)=>{let r=n.parsePath(t);n.trace("resolve:",t,e,r);var i=r?.name,a=n.templates,o=n.components,s=r.template||a[i]||document.getElementById(i);if(!s&&e&&(s=a[e]||document.getElementById(e),s&&(r.name=e)),c(s)&&s.startsWith("#")?s=document.getElementById(r.otemplate=s.substr(1)):c(s)&&s.startsWith("$")&&(s=a[r.otemplate=s.substr(1)]),!!s){r.template=s;var p=o[i]||o[r.name];return c(p)&&(p=o[r.ocomponent=p]),r.component=p,r}};n.render=(t,e)=>{var r=n.resolve(t,e);if(!r)return;var i=r.params=Object.assign(r.params||{},t?.params);i.$target=t.$target||i.$target||n.$target,n.trace("render:",t,r.name,r.params);let a=d(i.$target)||n.$(i.$target);if(a){var o=r.component?.$type||t?.plugin||i.$plugin;if(o=$[o]||A,!!o?.render){if(i.$target==n.$target){var s={name:r.name,params:i};if(n.emit(n.event,"prepare:delete",s),s.stop)return;var p=Object.values($);for(let l of p.filter(m=>m.cleanup))n.call(l.cleanup,a);t?.$nohistory||i.$nohistory||r.component?.$nohistory||n.$nohistory||queueMicrotask(()=>{n.emit("path:save",r)})}return n.emit("component:render",r),o.render(a,r),r}}};n.on("alpine:init",()=>{for(let t in $)n.call($[t],"init")});var v=class{params={};constructor(e,r){this.$name=e,Object.assign(this.params,r),this._handleEvent=j.bind(this),this._onCreate=this.onCreate||null,this._onDelete=this.onDelete||null}init(e){n.trace("init:",this.$type,this.$name),Object.assign(this.params,e),n.emit("component:create",{type:this.$type,name:this.$name,component:this,element:this.$el,params:this.params}),this.params.$noevents||n.on(n.event,this._handleEvent),n.call(this._onCreate?.bind(this,this.params))}destroy(){n.trace("destroy:",this.$type,this.$name),n.off(n.event,this._handleEvent),n.emit("component:delete",{type:this.$type,name:this.$name,component:this,element:this.$el,params:this.params}),n.call(this._onDelete?.bind(this)),this.params={},delete this.$root}};function j(t,...e){if(this.onEvent&&(n.trace("event:",this.$type,this.$name,t,...e),n.call(this.onEvent?.bind(this.$data||this),t,...e)),!!c(t)){var r=g("on_"+t);this[r]&&(n.trace("event:",this.$type,this.$name,r,...e),n.call(this[r]?.bind(this.$data||this),...e))}}var w=v;var y="alpine",x=class extends w{static $type=y;constructor(e,r){super(e,r),this.$type=y}init(){super.init(this.$root.parentElement._x_params)}},E=class extends HTMLElement{connectedCallback(){queueMicrotask(()=>{_(this,this.localName.substr(4))})}};function _(t,e){if(!(c(e)&&(e=n.resolve(e),!e))){if(n.$empty(t),t._x_params=Object.assign({},e.params),Alpine.onElRemoved(t,()=>{delete t._x_params}),!e.component)Alpine.mutateDom(()=>{n.$append(t,e.template,Alpine.initTree)});else{Alpine.data(e.name,()=>new e.component(e.name));let r=n.$elem("div","x-data",e.name);n.$append(r,e.template),Alpine.mutateDom(()=>{t.appendChild(r),Alpine.initTree(r)})}return e}}function T(t,e){if(d(t)||(t=n.$(n.$target+" div")),!!t)return typeof e=="number"?t._x_dataStack?.at(e):Alpine.closestDataStack(t)[0]}function D(){for(let[t,e]of Object.entries(n.components)){let r=`app-${e?.$tag||t}`;e?.$type!=y||customElements.get(r)||(customElements.define(r,class extends E{}),Alpine.data(t,()=>new e(t)))}}function S(t,e,r,i){let a=r.includes("cache"),o={url:e,post:r.includes("post")};!e.url&&!(!a&&/^(https?:\/\/|\/|.+\.html(\?|$)).+/.test(e))&&i(t,e)||n.fetch(o,(s,p,l)=>{if(s||!c(p))return console.warn("$render: Text expected from",e,"got",s,p);let m=c(e)?n.parsePath(e):e;m.template=p,m.name=m.params?.$name||m.name,a&&(n.templates[m.name]=p),i(t,m)})}function L(t,e,r){let i={},a=o=>{for(let p=0;p<r.length;p++){let l=r[p];switch(l){case"params":var s=Alpine.$data(t);if(!h(s[r[p+1]]))break;o.params=Object.assign(s[r[p+1]],o.params);break;case"inline":i.inline="inline-block";break;default:i[l]=l}}return o};S(t,e,r,(o,s)=>{if(s=n.resolve(s),!!s&&_(o,a(s)))return i.show&&(i.nonempty&&!o.firstChild?o.style.setProperty("display","none",i.important):o.style.setProperty("display",i.flex||i.inline||"block",i.important)),!0})}n.plugin(y,{render:_,Component:x,data:T,init:D,default:1});n.$on(document,"alpine:init",()=>{n.emit("alpine:init"),Alpine.magic("app",t=>n),Alpine.magic("params",t=>{for(;t;){if(t._x_params)return t._x_params;t=t.parentElement}}),Alpine.magic("component",t=>Alpine.closestDataStack(t).find(e=>e.$type==y&&e.$name)),Alpine.magic("parent",t=>Alpine.closestDataStack(t).filter(e=>e.$type==y&&e.$name)[1]),Alpine.directive("render",(t,{modifiers:e,expression:r},{evaluate:i,cleanup:a})=>{let o=s=>{let p=i(r);p&&(s.preventDefault(),e.includes("stop")&&s.stopPropagation(),S(t,p,e,(l,m)=>n.render(m)))};n.$on(t,"click",o),t.style.cursor="pointer",a(()=>{n.$off(t,"click",o)})}),Alpine.directive("template",(t,{modifiers:e,expression:r},{effect:i,cleanup:a})=>{let o=Alpine.evaluateLater(t,r);var s;let p=()=>{s=null,Alpine.mutateDom(()=>{n.$empty(t,l=>Alpine.destroyTree(l)),e.includes("show")&&t.style.setProperty("display","none",e.includes("important")?"important":void 0)})};i(()=>o(l=>{if(!l)return p();l!==s&&L(t,l,e),s=l})),a(p)}),Alpine.directive("scope-level",(t,{expression:e},{evaluate:r})=>{let i=Alpine.closestDataStack(t);t._x_dataStack=i.slice(0,parseInt(r(e||""))||0)})});function W(t){var e=c(t)?t:t?.url||"",r=t?.headers||{},i=Object.assign({headers:r,method:t?.method||t?.post&&"POST"||"GET",cache:"default"},t?.options),a=t?.body;return i.method=="GET"||i.method=="HEAD"?h(a)&&(e+="?"+new URLSearchParams(a).toString()):c(a)?(i.body=a,r["content-type"]??="application/x-www-form-urlencoded; charset=UTF-8"):a instanceof FormData?(i.body=a,delete r["content-type"]):h(a)?(i.body=JSON.stringify(a),r["content-type"]="application/json; charset=UTF-8"):a&&(i.body=a,r["content-type"]??="application/octet-stream"),[e,i]}n.fetch=function(t,e){try{let[r,i]=W(t);n.trace("fetch:",r,i,t),window.fetch(r,i).then(async a=>{var o,s,p={status:a.status,headers:{},type:a.type,url:a.url,redirected:a.redirected};for(let l of a.headers)p.headers[l[0].toLowerCase()]=l[1];if(!a.ok){if(/\/json/.test(p.headers["content-type"])){let l=await a.json();o={status:a.status};for(let m in l)o[m]=l[m]}else o={message:await a.text(),status:a.status};return n.call(e,o,s,p)}switch(t?.dataType){case"text":s=await a.text();break;case"blob":s=await a.blob();break;default:s=/\/json/.test(p.headers["content-type"])?await a.json():await a.text()}n.call(e,null,s,p)}).catch(a=>{n.call(e,a)})}catch(r){n.call(e,r)}};n.afetch=function(t){return new Promise((e,r)=>{n.fetch(t,(i,a,o)=>{if(i&&!t?.nocatch)return r(i,a,o);t?.nocatch&&(a={err:i,data:a,info:o}),e(a,o)})})};n.Component=w;var O=n;var rt=O;export{rt as default};
