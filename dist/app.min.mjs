var g={base:"/app/",main:"#app-main",index:"index",event:"component:event",templates:{},components:{}},n=g;n.noop=()=>{};n.log=(...e)=>console.log(...e);n.trace=(...e)=>{n.debug&&console.log(...e)};n.call=(e,t,...r)=>{if(typeof e=="function")return e(t,...r);if(typeof e=="object"){if(typeof t=="function")return t.call(e,...r);if(e&&typeof e[t]=="function")return e[t].call(e,...r)}};var c={};n.on=(e,t)=>{t&&(c[e]||(c[e]=[]),c[e].push(t))};n.off=(e,t)=>{if(!c[e]||!t)return;let r=c[e].indexOf(t);if(r>-1)return c[e].splice(r,1)};n.emit=(e,...t)=>{if(n.trace(e,...t),!!c[e])for(let r of c[e])n.call(r,...t)};var $=e=>typeof e=="string"?e.replace(/#([^\s"#']+)/g,(t,r)=>`#${CSS.escape(r)}`):"";n.$=(e,t)=>(t||document).querySelector($(e));n.$all=(e,t)=>(t||document).querySelectorAll($(e));n.$on=(e,t,r,...i)=>typeof r=="function"&&e.addEventListener(t,r,...i);n.$off=(e,t,r,...i)=>typeof r=="function"&&e.removeEventListener(t,r,...i);n.$attr=(e,t,r)=>{if(e instanceof HTMLElement)return r===void 0?e.getAttribute(t):r===null?e.removeAttribute(t):e.setAttribute(t,r)};n.$empty=(e,t)=>{if(e instanceof HTMLElement)for(;e.firstChild;){let r=e.firstChild;r.remove(),n.call(t,r)}};n.$param=(e,t)=>new URLSearchParams(location.search).get(e)||t||"";n.$elem=(e,...t)=>{var r=document.createElement(e),i;for(let s=0;s<t.length-1;s+=2)i=t[s],typeof i=="string"&&(typeof t[s+1]=="function"?n.$on(r,i,t[s+1],!1):i.startsWith(".")?r.style[i.substr(1)]=t[s+1]:i.startsWith("data-")?r.dataset[i.substr(5)]=t[s+1]:i.startsWith(":")?r[i.substr(1)]=t[s+1]:r.setAttribute(i,t[s+1]??""));return r};var p=[];n.$ready=e=>{if(p.push(e),document.readyState!="loading")for(;p.length;)setTimeout(n.call,0,p.shift())};n.$on(window,"DOMContentLoaded",()=>{for(;p.length;)setTimeout(n.call,0,p.shift())});n.parsePath=e=>{var t={name:"",params:{}},r,i=window.location;if(typeof e!="string")return t;var s=n.base;e.startsWith(i.origin)&&(e=e.substr(i.origin.length)),e.includes("://")&&(e=e.replace(/^(.*:\/\/[^\/]*)/,"")),e.startsWith(s)&&(e=e.substr(s.length)),e.startsWith("/")&&(e=e.substr(1)),e==s.slice(1,-1)&&(e="");let o=e.indexOf("?");if(o>0&&(r=e.substr(o+1,1024),t.name=e=e.substr(0,o)),e.includes("/")){e=e.split("/").slice(0,5),t.name=e.shift();for(let a=0;a<e.length;a++)e[a]&&(t.params[`param${a+1}`]=e[a])}else t.name=e||"";if(r)for(let[a,l]of new URLSearchParams(r).entries())t.params[a]=l;return t};n.savePath=e=>{if(typeof e=="string"&&(e={name:e}),!!e?.name){var t=[e.name];if(e?.params)for(let r=1;r<5;r++)t.push(e.params[`param${r}`]||"");for(;!t.at(-1);)t.length--;t=t.join("/"),n.trace("savePath:",t,e),t&&window.history.pushState(null,"",window.location.origin+n.base+t)}};n.restorePath=e=>{n.trace("restorePath:",e,n.index),n.render(e,n.index)};n.start=()=>{n.on("path:save",n.savePath),n.on("path:restore",n.restorePath),n.$ready(n.restorePath.bind(n,window.location.href))};n.$on(window,"popstate",()=>n.emit("path:restore",window.location.href));var d={},v;n.plugin=(e,t)=>{if(!e||typeof e!="string")throw Error("type must be defined");if(t){for(let i of["render","cleanup"])if(t[i]&&typeof t[i]!="function")throw Error(i+" must be a function");typeof t?.Component=="function"&&(n[`${e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()}Component`]=t.Component)}var r=d[e]=d[e]||{};return t?.default&&(v=r),Object.assign(r,t)};n.resolve=(e,t)=>{let r=n.parsePath(e);n.trace("resolve:",e,t,r);var i=r.name,s=n.templates,o=n.components,a=s[i]||document.getElementById(i)?.innerHTML;if(!a&&t&&(a=s[t]||document.getElementById(t)?.innerHTML,a&&(r.name=t)),a?.startsWith("#")?a=document.getElementById(a.substr(1))?.innerHTML:a?.startsWith("$")&&(a=s[a.substr(1)]),!!a){r.template=a;var l=o[i]||o[r.name];return typeof l=="string"&&(l=o[l]),r.component=l,r}};n.render=(e,t)=>{var r=n.resolve(e?.name||e,t);if(!r)return;var i=r.params;Object.assign(i,e?.params),n.trace("render:",e,r.name,r.params);let s=n.$(i.$target||n.main);if(s){var o=r.component?.$type||e?.plugin||i.$plugin;if(o=d[o]||v,!!o?.render){if(!i.$target||i.$target==n.main){var a={name:r.name,params:i};if(n.emit(n.event,"prepare:delete",a),a.stop)return;var l=Object.values(d);for(let m of l.filter(b=>b.cleanup))n.call(m.cleanup,s);e?.nohistory||i.$nohistory||queueMicrotask(()=>{n.emit("path:save",r)})}return n.emit("component:render",r),o.render(s,r),r}}};var f="alpine",u=class e{template="";params={};static $type=f;static _id=0;constructor(t,r){this.$name=t,this.$_id=`${t}:${f}:${e._id++}`,Object.assign(this.params,r),this._handleEvent=this.handleEvent.bind(this)}init(){n.trace("init:",this.$_id),Object.assign(this.params,this.$el._x_params),n.call(this.onCreate?.bind(this)),this.params.$noevents||n.on(n.event,this._handleEvent),n.emit("component:create",{type:f,name:this.$name,component:this,element:this.$el,params:Alpine.raw(this.params)})}destroy(){n.trace("destroy:",this.$_id),n.off(n.event,this._handleEvent),n.emit("component:delete",{type:f,name:this.$name,component:this,element:this.$el,params:Alpine.raw(this.params)}),n.call(this.onDelete?.bind(this)),this.params={}}handleEvent(t,...r){if(n.trace("event:",this.$_id,...r),n.call(this.onEvent?.bind(this.$data),t,...r),typeof t=="string"){var i=("on_"+t).toLowerCase().replace(/[.:_-](\w)/g,(s,o)=>o.toUpperCase());n.call(this[i]?.bind(this.$data),...r)}}},h=class extends HTMLElement{connectedCallback(){y(this,this.getAttribute("template")||this.localName.substr(Alpine.prefixed().length))}};function y(e,t){if(typeof t=="string"&&(t=n.resolve(t),!t))return;n.$empty(e);let r=new DOMParser().parseFromString(t.template,"text/html").body;if(!t.component)Alpine.mutateDom(()=>{for(;r.firstChild;){let i=r.firstChild;e.appendChild(i),i.nodeType==1&&(Alpine.addScopeToNode(i,{},e),Alpine.initTree(i))}});else{let i=n.$elem("div","x-data",t.name,":_x_params",t.params);for(;r.firstChild;)i.appendChild(r.firstChild);Alpine.mutateDom(()=>{e.appendChild(i),Alpine.initTree(i),delete i._x_params})}}n.plugin(f,{render:y,Component:u,default:1});n.$on(document,"alpine:init",()=>{for(let[e,t]of Object.entries(n.components))t?.$type==f&&(customElements.define(Alpine.prefixed(e),class extends h{}),Alpine.data(e,()=>new t(e)));Alpine.magic("app",e=>n),Alpine.directive("render",(e,{modifiers:t,expression:r},{evaluate:i,cleanup:s})=>{let o=a=>{a.preventDefault(),n.render(i(r))};n.$on(e,"click",o),e.style.cursor="pointer",s(()=>{n.$off(e,"click",o)})}),Alpine.directive("template",(e,{expression:t},{effect:r,cleanup:i})=>{let s=Alpine.evaluateLater(e,t||"template"),o=()=>{Alpine.mutateDom(()=>{n.$empty(e,a=>Alpine.destroyTree(a))})};r(()=>s(a=>{a?y(e,a):o()})),i(o)})});n.fetchOpts=function(e){var t=e.headers||{},r=Object.assign({headers:t,method:e.type||"POST",cache:"default"},e.fetchOptions),i=e.data;return r.method=="GET"||r.method=="HEAD"?typeof i=="object"&&i&&(e.url+="?"+new URLSearchParams(i).toString()):typeof i=="string"?(r.body=i,t["content-type"]=e.contentType||"application/x-www-form-urlencoded; charset=UTF-8"):i instanceof FormData?(r.body=i,delete t["content-type"]):typeof i=="object"?(r.body=JSON.stringify(i),t["content-type"]="application/json; charset=UTF-8"):i&&(r.body=i,t["content-type"]=e.contentType||"application/octet-stream"),r};n.fetch=function(e,t){try{let r=n.fetchOpts(e);window.fetch(e.url,r).then(async i=>{var s,o,a={status:i.status,headers:{},type:i.type};for(let l of i.headers)a.headers[l[0].toLowerCase()]=l[1];if(!i.ok){if(/\/json/.test(a.headers["content-type"])){let l=await i.json();s={status:i.status};for(let m in l)s[m]=l[m]}else s={message:await i.text(),status:i.status};return n.call(t,s,o,a)}switch(e.dataType){case"text":o=await i.text();break;case"blob":o=await i.blob();break;default:o=/\/json/.test(a.headers["content-type"])?await i.json():await i.text()}n.call(t,null,o,a)}).catch(i=>{n.call(t,i)})}catch(r){n.call(t,r)}};var w=n;var F=w;export{F as default};
